<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Te quiero</title>
<style>
  body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #fff;
    overflow: hidden;
    background-image: url('fondo.png');
    background-repeat: repeat;
    background-size: 100px 100px;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #000;
  }
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    pointer-events: none;
    z-index: -1;
  }
  #menu {
    display: grid;
    grid-template-columns: repeat(3, 200px);
    grid-template-rows: repeat(3, 140px);
    gap: 20px;
    justify-content: center;
    align-content: center;
    place-items: center;
  }
  #menu img {
    width: 180px;
    height: 120px;
    object-fit: cover;
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  #menu img:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 24px rgba(0,0,0,0.5);
  }
  #puzzle-container {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
  }
  #board {
    display: grid;
    border: 4px solid #ff6699;
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
  }
  .piece {
    border: 1px solid #ccc;
    cursor: grab;
    transition: transform 0.2s, box-shadow 0.2s;
    touch-action: none;
  }
  .piece.dragging {
    opacity: 0.9;
    z-index: 10;
    box-shadow: 0 12px 20px rgba(0,0,0,0.6);
  }
  .buttons {
    margin-top: 20px;
  }
  button {
    padding: 12px 22px;
    margin: 0 10px;
    border: none;
    border-radius: 10px;
    background: #ff6699;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
  }
  button:hover {
    background: #cc3366;
    transform: scale(1.05);
  }
  #dedication {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.95);
    color: #00ff66;
    font-size: 3em;
    font-weight: bold;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
    z-index: 100;
    animation: fadeIn 2s ease-in-out;
  }
  @keyframes fadeIn {
    from {opacity: 0;} to {opacity: 1;}
  }
</style>
</head>
<body>

<div id="menu">
    <img src="foto1.png" alt="Foto 1" onclick="startPuzzle('foto1.png')">
    <img src="foto2.png" alt="Foto 2" onclick="startPuzzle('foto2.png')">
    <img src="foto3.png" alt="Foto 3" onclick="startPuzzle('foto3.png')">
    <img src="foto4.png" alt="Foto 4" onclick="startPuzzle('foto4.png')">
    <img src="foto5.png" alt="Foto 5" onclick="startPuzzle('foto5.png')">
    <img src="foto6.png" alt="Foto 6" onclick="startPuzzle('foto6.png')">
    <img src="foto7.png" alt="Foto 7" onclick="startPuzzle('foto7.png')">
    <img src="foto8.png" alt="Foto 8" onclick="startPuzzle('foto8.png')">
    <img src="foto9.png" alt="Foto 9" onclick="startPuzzle('foto9.png')">
</div>

<div id="puzzle-container">
  <div id="board"></div>
  <div class="buttons">
    <button onclick="shufflePieces()">Barajar</button>
  </div>
  <div id="dedication"></div>
</div>

<script>
let rows = 3, cols = 3;
let board = document.getElementById('board');
let pieces = [];
let dedication = document.getElementById('dedication');

let frases = [
  'ðŸ’šTe quiero mucho mi TrexðŸ’š',
  'ðŸ’šTe quiero Danieliiixx ðŸ’š',
  'ðŸ’šGracias por ser como eres y por lo que hacesðŸ’š',
  'ðŸ’šEres mi alegrÃ­a cada dÃ­aðŸ’š',
  'ðŸ’šCada momento contigo es ÃºnicoðŸ’š'
];

function startPuzzle(imgSrc){
  dedication.style.display = 'none';
  let img = new Image();
  img.src = imgSrc;
  img.onload = function(){
    let maxWidth = window.innerWidth * 0.6;
    let maxHeight = window.innerHeight * 0.6;
    let scale = Math.min(maxWidth / img.width, maxHeight / img.height, 1);
    let boardWidth = img.width * scale;
    let boardHeight = img.height * scale;

    document.getElementById('menu').style.display = 'none';
    document.getElementById('puzzle-container').style.display = 'flex';

    board.style.width = boardWidth + 'px';
    board.style.height = boardHeight + 'px';
    board.style.gridTemplateColumns = `repeat(${cols}, ${boardWidth/cols}px)`;
    board.style.gridTemplateRows = `repeat(${rows}, ${boardHeight/rows}px)`;
    board.style.margin = 'auto';
    board.innerHTML = '';

    pieces = [];
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        let piece = document.createElement('div');
        piece.classList.add('piece');
        piece.style.width = `${boardWidth/cols}px`;
        piece.style.height = `${boardHeight/rows}px`;
        piece.style.backgroundImage = `url(${imgSrc})`;
        piece.style.backgroundSize = `${boardWidth}px ${boardHeight}px`;
        piece.style.backgroundPosition = `${-c*(boardWidth/cols)}px ${-r*(boardHeight/rows)}px`;
        piece.dataset.row = r;
        piece.dataset.col = c;
        piece.dataset.currentIndex = r*cols+c;
        pieces.push(piece);
      }
    }

    shuffleArray(pieces);
    renderBoard();
  }
}

function renderBoard(){
  board.innerHTML='';
  pieces.forEach(p=>{
    board.appendChild(p);
    p.setAttribute('draggable', true);
    p.addEventListener('dragstart',dragStart);
    p.addEventListener('dragover',dragOver);
    p.addEventListener('drop',drop);
    p.addEventListener('dragend',dragEnd);
  });
}

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

let dragged;
function dragStart(e){ dragged=this; setTimeout(()=>this.classList.add('dragging'),0); }
function dragOver(e){ e.preventDefault(); }
function drop(e){
  e.preventDefault();
  if(dragged===this) return;
  let i1 = pieces.indexOf(dragged);
  let i2 = pieces.indexOf(this);
  [pieces[i1], pieces[i2]] = [pieces[i2], pieces[i1]];
  renderBoard();
  checkWin();
}
function dragEnd(e){ this.classList.remove('dragging'); }

function checkWin(){
  for(let i=0;i<pieces.length;i++){
    let p = pieces[i];
    let correctIndex = parseInt(p.dataset.row)*cols + parseInt(p.dataset.col);
    if(i !== correctIndex) return false;
  }

  let frase = frases[Math.floor(Math.random()*frases.length)];
  dedication.textContent = frase;
  dedication.style.display = 'flex';

  // Eliminar cualquier botÃ³n previo
  let existingBtn = dedication.querySelector('button');
  if(existingBtn) existingBtn.remove();

  // DespuÃ©s de 5 segundos, mostrar botÃ³n de volver al menÃº
  setTimeout(()=>{
    let btn = document.createElement('button');
    btn.textContent = "Volver al menÃº";
    btn.onclick = backToMenu;
    btn.style.marginTop = "20px";
    btn.style.padding = "12px 22px";
    btn.style.border = "none";
    btn.style.borderRadius = "10px";
    btn.style.background = "#ff6699";
    btn.style.color = "#fff";
    btn.style.fontWeight = "bold";
    btn.style.cursor = "pointer";
    btn.style.fontSize = "1em";
    btn.style.transition = "background 0.3s, transform 0.2s";
    btn.onmouseover = () => { btn.style.background="#cc3366"; btn.style.transform="scale(1.05)"; };
    btn.onmouseleave = () => { btn.style.background="#ff6699"; btn.style.transform="scale(1)"; };
    dedication.appendChild(btn);
  },5000);

  return true;
}

function shufflePieces(){
  shuffleArray(pieces);
  dedication.style.display = 'none';
  renderBoard();
}

function backToMenu(){
  document.getElementById('puzzle-container').style.display='none';
  document.getElementById('menu').style.display='grid';
  dedication.style.display = 'none';
}
</script>
</body>
</html>
